---
sidebar: sidebar 
permalink: use/upgrade-acc.html 
keywords: astra upgrade, upgrade astra control center, how to upgrade astra control, update 
summary: Zum Upgrade von Astra Control Center laden Sie das Paket herunter und führen Sie die beschriebenen Schritte aus. 
---
= Upgrade Astra Control Center
:hardbreaks:
:allow-uri-read: 
:icons: font
:imagesdir: ../media/get-started/


[role="lead"]
Laden Sie zum Upgrade des Astra Control Center das Installationspaket von der NetApp Support Site herunter, und füllen Sie die folgenden Anweisungen aus. Mit diesem Verfahren können Sie das Astra Control Center in internetverbundenen oder luftgekapderten Umgebungen aktualisieren.

.Was Sie benötigen
* Bevor Sie ein Upgrade durchführen, lesen Sie link:../get-started/requirements.html#operational-environment-requirements["Anforderungen an die Betriebsumgebung"^] Damit Ihre Umgebung die Mindestanforderungen für die Implementierung von Astra Control Center erfüllt. Ihre Umgebung sollte Folgendes haben:
+
** Eine unterstützte Astra Trident-Version um die Version zu bestimmen, die Sie ausführen, führen Sie den folgenden Befehl gegen Ihr vorhandenes Astra Control Center aus:
+
[listing]
----
kubectl get tridentversion -n trident
----
+
Siehe https://docs.netapp.com/us-en/trident/trident-managing-k8s/upgrade-trident.html#determine-the-version-to-upgrade-to["Astra Trident-Dokumentation"] Zum Upgrade von einer älteren Version.

+

WARNING: Sie müssen ein Upgrade auf Astra Trident 22.10 * VOR* auf Kubernetes 1.25 durchführen.

** Eine unterstützte Kubernetes-Distribution, um zu bestimmen, welche Version Sie ausführen, führen Sie den folgenden Befehl gegen Ihr bestehendes Astra Control Center aus: `kubectl get nodes -o wide`
** Ausreichende Cluster-Ressourcen zur Ermittlung von Cluster-Ressourcen: Führen Sie den folgenden Befehl in Ihrem vorhandenen Astra Control Center-Cluster aus: `kubectl describe node <node name>`
** Eine Registrierung, mit der Sie Bilder des Astra Control Centers übertragen und hochladen können
** Führen Sie als Standard-Storage-Klasse den folgenden Befehl für Ihr vorhandenes Astra Control Center aus, um Ihre Standard-Storage-Klasse zu bestimmen: `kubectl get storageclass`


* (Nur OpenShift) Stellen Sie sicher, dass sich alle Clusterbetreiber in einem gesunden Zustand befinden und verfügbar sind.
+
[listing]
----
kubectl get clusteroperators
----
* Stellen Sie sicher, dass alle API-Services in einem gesunden Zustand und verfügbar sind.
+
[listing]
----
kubectl get apiservices
----
* Melden Sie sich von der Astra Control Center-Benutzeroberfläche ab, bevor Sie das Upgrade starten.


.Über diese Aufgabe
Der Astra Control Center Upgrade-Prozess führt Sie durch die folgenden grundlegenden Schritte:

* <<Laden Sie das Astra Control Center herunter und extrahieren Sie es>>
* <<Entfernen Sie das NetApp Astra kubectl Plugin und installieren Sie es erneut>>
* <<Fügen Sie die Bilder Ihrer lokalen Registrierung hinzu>>
* <<Installieren Sie den aktualisierten Astra Control Center-Operator>>
* <<Upgrade Astra Control Center>>
* <<Überprüfen Sie den Systemstatus>>



IMPORTANT: Löschen Sie den Operator Astra Control Center nicht (z. B. `kubectl delete -f astra_control_center_operator_deploy.yaml`) Zu jeder Zeit während des Astra Control Center Upgrades oder Betrieb, um zu vermeiden, dass Pods gelöscht werden.


TIP: Führen Sie Upgrades in einem Wartungsfenster durch, wenn Zeitpläne, Backups und Snapshots nicht ausgeführt werden.



== Laden Sie das Astra Control Center herunter und extrahieren Sie es

. Wechseln Sie zum https://mysupport.netapp.com/site/products/all/details/astra-control-center/downloads-tab["Astra Control Center: Seite zum Herunterladen von Produkten"^] Auf der NetApp Support Site Sie können die neueste Version oder eine andere Version aus dem Dropdown-Menü auswählen.
. Laden Sie das Bundle mit Astra Control Center herunter (`astra-control-center-[version].tar.gz`).
. (Empfohlen, aber optional) Laden Sie das Zertifikaten- und Unterschriftenpaket für Astra Control Center herunter (`astra-control-center-certs-[version].tar.gz`) Um die Signatur des Pakets zu überprüfen:
+
[source, console]
----
tar -vxzf astra-control-center-certs-[version].tar.gz
----
+
[source, console]
----
openssl dgst -sha256 -verify certs/AstraControlCenter-public.pub -signature certs/astra-control-center-[version].tar.gz.sig astra-control-center-[version].tar.gz
----
+
Die Ausgabe wird angezeigt `Verified OK` Nach erfolgreicher Überprüfung.

. Extrahieren Sie die Bilder aus dem Astra Control Center Bundle:
+
[source, console]
----
tar -vxzf astra-control-center-[version].tar.gz
----




== Entfernen Sie das NetApp Astra kubectl Plugin und installieren Sie es erneut

Das NetApp Astra kubectl Kommandozeilen-Plug-in spart Zeit, wenn es gängige Aufgaben im Zusammenhang mit der Bereitstellung und dem Upgrade des Astra Control Center ausführt.

. Ermitteln Sie, ob das Plug-in installiert ist:
+
[listing]
----
kubectl astra
----
. Führen Sie eine der folgenden Aktionen durch:
+
** Falls das Plugin installiert ist, sollte der Befehl die kubectl Plugin-Hilfe zurückgeben. Führen Sie folgenden Befehl aus, um eine vorhandene Version von kubectl-astra zu entfernen: `delete /usr/local/bin/kubectl-astra`.
** Wenn der Befehl einen Fehler zurückgibt, ist das Plugin nicht installiert und Sie können mit dem nächsten Schritt fortfahren, um es zu installieren.


. Installieren Sie das Plugin:
+
.. Geben Sie die verfügbaren Plug-ins-Binärdateien von NetApp Astra kubectl an und notieren Sie sich den Namen der für Ihr Betriebssystem und die CPU-Architektur erforderlichen Datei:
+

NOTE: Die kubectl Plugin-Bibliothek ist Teil des tar-Bündels und wird in den Ordner extrahiert `kubectl-astra`.

+
[source, console]
----
ls kubectl-astra/
----
.. Verschieben Sie die richtige Binärdatei in den aktuellen Pfad, und benennen Sie sie in um `kubectl-astra`:
+
[source, console]
----
cp kubectl-astra/<binary-name> /usr/local/bin/kubectl-astra
----






== Fügen Sie die Bilder Ihrer lokalen Registrierung hinzu

. Führen Sie die entsprechende Schrittfolge für Ihre Container-Engine durch:


[role="tabbed-block"]
====
.Docker
--
. Wechseln Sie in das Stammverzeichnis des Tarballs. Sie sollten diese Datei und das Verzeichnis sehen:
+
`acc.manifest.bundle.yaml`
`acc/`

. Übertragen Sie die Paketbilder im Astra Control Center-Bildverzeichnis in Ihre lokale Registrierung. Führen Sie die folgenden Ersetzungen durch, bevor Sie den ausführen `push-images` Befehl:
+
** Ersetzen Sie <BUNDLE_FILE> durch den Namen der Astra Control Bundle-Datei (`acc.manifest.bundle.yaml`).
** <MY_FULL_REGISTRY_PATH> durch die URL des Docker Repositorys ersetzen, beispielsweise "https://<docker-registry>"[].
** Ersetzen Sie <MY_REGISTRY_USER> durch den Benutzernamen.
** Ersetzen Sie <MY_REGISTRY_TOKEN> durch ein autorisiertes Token für die Registrierung.
+
[source, console]
----
kubectl astra packages push-images -m <BUNDLE_FILE> -r <MY_FULL_REGISTRY_PATH> -u <MY_REGISTRY_USER> -p <MY_REGISTRY_TOKEN>
----




--
.Podman
--
. Wechseln Sie in das Stammverzeichnis des Tarballs. Sie sollten diese Datei und das Verzeichnis sehen:
+
`acc.manifest.bundle.yaml`
`acc/`

. Melden Sie sich bei Ihrer Registrierung an:
+
[source, console]
----
podman login <YOUR_REGISTRY>
----
. Vorbereiten und Ausführen eines der folgenden Skripts, das für die von Ihnen verwendete Podman-Version angepasst ist. Ersetzen Sie <MY_FULL_REGISTRY_PATH> durch die URL Ihres Repositorys, die alle Unterverzeichnisse enthält.
+
[source, subs="specialcharacters,quotes"]
----
*Podman 4*
----
+
[source, console]
----
export REGISTRY=<MY_FULL_REGISTRY_PATH>
export PACKAGENAME=acc
export PACKAGEVERSION=22.11.0-82
export DIRECTORYNAME=acc
for astraImageFile in $(ls ${DIRECTORYNAME}/images/*.tar) ; do
astraImage=$(podman load --input ${astraImageFile} | sed 's/Loaded image: //')
astraImageNoPath=$(echo ${astraImage} | sed 's:.*/::')
podman tag ${astraImageNoPath} ${REGISTRY}/netapp/astra/${PACKAGENAME}/${PACKAGEVERSION}/${astraImageNoPath}
podman push ${REGISTRY}/netapp/astra/${PACKAGENAME}/${PACKAGEVERSION}/${astraImageNoPath}
done
----
+
[source, subs="specialcharacters,quotes"]
----
*Podman 3*
----
+
[source, console]
----
export REGISTRY=<MY_FULL_REGISTRY_PATH>
export PACKAGENAME=acc
export PACKAGEVERSION=22.11.0-82
export DIRECTORYNAME=acc
for astraImageFile in $(ls ${DIRECTORYNAME}/images/*.tar) ; do
astraImage=$(podman load --input ${astraImageFile} | sed 's/Loaded image: //')
astraImageNoPath=$(echo ${astraImage} | sed 's:.*/::')
podman tag ${astraImageNoPath} ${REGISTRY}/netapp/astra/${PACKAGENAME}/${PACKAGEVERSION}/${astraImageNoPath}
podman push ${REGISTRY}/netapp/astra/${PACKAGENAME}/${PACKAGEVERSION}/${astraImageNoPath}
done
----
+

NOTE: Der Bildpfad, den das Skript erstellt, sollte abhängig von Ihrer Registrierungskonfiguration wie folgt aussehen: `https://netappdownloads.jfrog.io/docker-astra-control-prod/netapp/astra/acc/22.11.0-82/image:version`



--
====


== Installieren Sie den aktualisierten Astra Control Center-Operator

. Telefonbuch ändern:
+
[listing]
----
cd manifests
----
. Bearbeiten Sie die yaml-Implementierung des Astra Control Center-Bedieners (`astra_control_center_operator_deploy.yaml`) Zu Ihrem lokalen Register und Geheimnis zu verweisen.
+
[listing]
----
vim astra_control_center_operator_deploy.yaml
----
+
.. Wenn Sie eine Registrierung verwenden, die eine Authentifizierung erfordert, ersetzen oder bearbeiten Sie die Standardzeile von `imagePullSecrets: []` Mit folgenden Optionen:
+
[listing]
----
imagePullSecrets:
- name: <astra-registry-cred_or_custom_name_of_secret>
----
.. Ändern `[your_registry_path]` Für das `kube-rbac-proxy` Bild zum Registrierungspfad, in dem Sie die Bilder in ein geschoben haben <<Fügen Sie die Bilder Ihrer lokalen Registrierung hinzu,Vorheriger Schritt>>.
.. Ändern `[your_registry_path]` Für das `acc-operator` Bild zum Registrierungspfad, in dem Sie die Bilder in ein geschoben haben <<Fügen Sie die Bilder Ihrer lokalen Registrierung hinzu,Vorheriger Schritt>>.
.. Fügen Sie dem die folgenden Werte hinzu `env` Abschnitt:
+
[listing]
----
- name: ACCOP_HELM_UPGRADETIMEOUT
  value: 300m
----
+
[listing, subs="+quotes"]
----
apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    control-plane: controller-manager
  name: acc-operator-controller-manager
  namespace: netapp-acc-operator
spec:
  replicas: 1
  selector:
    matchLabels:
      control-plane: controller-manager
  strategy:
    type: Recreate
  template:
    metadata:
      labels:
        control-plane: controller-manager
    spec:
      containers:
      - args:
        - --secure-listen-address=0.0.0.0:8443
        - --upstream=http://127.0.0.1:8080/
        - --logtostderr=true
        - --v=10
        *image: [your_registry_path]/kube-rbac-proxy:v4.8.0*
        name: kube-rbac-proxy
        ports:
        - containerPort: 8443
          name: https
      - args:
        - --health-probe-bind-address=:8081
        - --metrics-bind-address=127.0.0.1:8080
        - --leader-elect
        env:
        - name: ACCOP_LOG_LEVEL
          value: "2"
        *- name: ACCOP_HELM_UPGRADETIMEOUT*
          *value: 300m*
        *image: [your_registry_path]/acc-operator:[version x.y.z]*
        imagePullPolicy: IfNotPresent
        livenessProbe:
          httpGet:
            path: /healthz
            port: 8081
          initialDelaySeconds: 15
          periodSeconds: 20
        name: manager
        readinessProbe:
          httpGet:
            path: /readyz
            port: 8081
          initialDelaySeconds: 5
          periodSeconds: 10
        resources:
          limits:
            cpu: 300m
            memory: 750Mi
          requests:
            cpu: 100m
            memory: 75Mi
        securityContext:
          allowPrivilegeEscalation: false
      *imagePullSecrets: []*
      securityContext:
        runAsUser: 65532
      terminationGracePeriodSeconds: 10
----


. Installieren Sie den aktualisierten Astra Control Center-Operator:
+
[listing]
----
kubectl apply -f astra_control_center_operator_deploy.yaml
----
+
Beispielantwort:

+
[listing]
----
namespace/netapp-acc-operator unchanged
customresourcedefinition.apiextensions.k8s.io/astracontrolcenters.astra.netapp.io configured
role.rbac.authorization.k8s.io/acc-operator-leader-election-role unchanged
clusterrole.rbac.authorization.k8s.io/acc-operator-manager-role configured
clusterrole.rbac.authorization.k8s.io/acc-operator-metrics-reader unchanged
clusterrole.rbac.authorization.k8s.io/acc-operator-proxy-role unchanged
rolebinding.rbac.authorization.k8s.io/acc-operator-leader-election-rolebinding unchanged
clusterrolebinding.rbac.authorization.k8s.io/acc-operator-manager-rolebinding configured
clusterrolebinding.rbac.authorization.k8s.io/acc-operator-proxy-rolebinding unchanged
configmap/acc-operator-manager-config unchanged
service/acc-operator-controller-manager-metrics-service unchanged
deployment.apps/acc-operator-controller-manager configured
----
. Überprüfen Sie, ob Pods ausgeführt werden:
+
[listing]
----
kubectl get pods -n netapp-acc-operator
----




== Upgrade Astra Control Center

. Bearbeiten der benutzerdefinierten Ressource des Astra Control Center (CR):
+
[listing]
----
kubectl edit AstraControlCenter -n [netapp-acc or custom namespace]
----
. Ändern Sie die Versionsnummer des Astra (`astraVersion` Innerhalb von `Spec`) Zu der Version, auf die Sie aktualisieren:
+
[listing, subs="+quotes"]
----
spec:
  accountName: "Example"
  *astraVersion: "[Version number]"*
----
. Überprüfen Sie, ob Ihr Image-Registrierungspfad mit dem von Ihnen gedrückten Registrierungspfad übereinstimmt <<Fügen Sie die Bilder Ihrer lokalen Registrierung hinzu,Vorheriger Schritt>>. Aktualisierung `imageRegistry` Innerhalb von `Spec` Wenn sich die Registrierung seit Ihrer letzten Installation geändert hat.
+
[listing]
----
  imageRegistry:
    name: "[your_registry_path]"
----
. Fügen Sie Folgendes zu Ihrem hinzu `CRDs` Konfiguration in `Spec`:
+
[listing]
----
crds:
  shouldUpgrade: true
----
. Fügen Sie die folgenden Zeilen in hinzu `additionalValues` Innerhalb von `Spec` Im Astra Control Center CR:
+
[listing]
----
additionalValues:
    nautilus:
      startupProbe:
        periodSeconds: 30
        failureThreshold: 600
----
+
Nachdem Sie den Datei-Editor gespeichert und beendet haben, werden die Änderungen übernommen und das Upgrade wird gestartet.

. (Optional) Stellen Sie sicher, dass die Pods beendet werden und wieder verfügbar sind:
+
[listing]
----
watch kubectl get pods -n [netapp-acc or custom namespace]
----
. Warten Sie, bis die Statusbedingungen des Astra Control angezeigt werden, um anzuzeigen, dass das Upgrade abgeschlossen und bereit ist (`True`):
+
[listing]
----
kubectl get AstraControlCenter -n [netapp-acc or custom namespace]
----
+
Antwort:

+
[listing]
----
NAME    UUID                                      VERSION     ADDRESS         READY
astra   9aa5fdae-4214-4cb7-9976-5d8b4c0ce27f      22.11.0-82  10.111.111.111  True
----
+

NOTE: Führen Sie den folgenden Befehl aus, um den Upgrade-Status während des Vorgangs zu überwachen: `kubectl get AstraControlCenter -o yaml -n [netapp-acc or custom namespace]`

+

NOTE: Führen Sie den folgenden Befehl aus, um die Bedienerprotokolle des Astra Control Center zu überprüfen:
`kubectl logs deploy/acc-operator-controller-manager -n netapp-acc-operator -c manager -f`





== Überprüfen Sie den Systemstatus

. Melden Sie sich beim Astra Control Center an.
. Überprüfen Sie, ob die Version aktualisiert wurde. Weitere Informationen finden Sie auf der Seite *Support* in der Benutzeroberfläche.
. Vergewissern Sie sich, dass alle gemanagten Cluster und Applikationen weiterhin vorhanden und geschützt sind.

